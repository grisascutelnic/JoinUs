<div th:fragment="navbar">
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="/" th:href="@{/}">
                <span class="navbar-brand-text">
                    JoinUs
                    <small>Community Hub</small>
                </span>
            </a>

            <div class="d-lg-none ms-auto me-3" th:if="${#authorization.expression('isAnonymous()')}">
                <a class="btn custom-btn custom-border-btn js-auth-link" href="#" data-auth-trigger="login">Login</a>
            </div>

            <div class="d-lg-none ms-auto me-3 d-flex align-items-center gap-2" th:if="${#authorization.expression('isAuthenticated()')}">
                <a class="navbar-user-chip navbar-user-chip-link d-flex align-items-center gap-2" href="/profile" th:href="@{/profile}">
                    <img th:if="${currentUserAvatarUrl != null}"
                         th:src="${currentUserAvatarUrl}"
                         alt="Avatar"
                         class="rounded-circle navbar-user-avatar">
                    <i th:if="${currentUserAvatarUrl == null}" class="bi bi-person-circle fs-4 navbar-user-icon" aria-hidden="true"></i>
                    <span class="navbar-user-name" th:text="${currentUserDisplayName != null ? currentUserDisplayName : #authentication.name}">Utilizator</span>
                </a>
                <form th:action="@{/logout}" method="post" class="m-0">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="submit" class="btn custom-btn custom-border-btn">Logout</button>
                </form>
            </div>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-lg-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/" th:href="@{/}">Home</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="/activities" th:href="@{/activities}">Activities</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="/calendar" th:href="@{/calendar}">Calendar</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="/chat" th:href="@{/chat}">Chat</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="offcanvas" href="#notificationsPanel" role="button" aria-controls="notificationsPanel">Notifications</a>
                    </li>
                </ul>

                <div class="d-none d-lg-block ms-lg-3" th:if="${#authorization.expression('isAnonymous()')}">
                    <a class="btn custom-btn custom-border-btn js-auth-link" href="#" data-auth-trigger="login">Login</a>
                </div>

                <div class="d-none d-lg-flex align-items-center gap-2 ms-lg-3" th:if="${#authorization.expression('isAuthenticated()')}">
                    <a class="navbar-user-chip navbar-user-chip-link d-flex align-items-center gap-2" href="/profile" th:href="@{/profile}">
                        <img th:if="${currentUserAvatarUrl != null}"
                             th:src="${currentUserAvatarUrl}"
                             alt="Avatar"
                             class="rounded-circle navbar-user-avatar">
                        <i th:if="${currentUserAvatarUrl == null}" class="bi bi-person-circle fs-4 navbar-user-icon" aria-hidden="true"></i>
                        <span class="navbar-user-name" th:text="${currentUserDisplayName != null ? currentUserDisplayName : #authentication.name}">Utilizator</span>
                    </a>
                    <form th:action="@{/logout}" method="post" class="m-0">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <button type="submit" class="btn custom-btn custom-border-btn">Logout</button>
                    </form>
                </div>
            </div>
        </div>
    </nav>

    <div class="modal fade auth-modal" id="loginModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content auth-modal-content">
                <div class="modal-body">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    <div class="auth-card auth-card--modal">
                        <h3 class="mb-3">Sign in</h3>
                        <p class="auth-subtitle">Use your email and password to continue.</p>

                        <div class="alert alert-success" th:if="${param.registered}">
                            Account created successfully. You can sign in now.
                        </div>
                        <div class="alert alert-danger" th:if="${param.error}">
                            Incorrect email or password.
                        </div>
                        <div class="alert alert-info" th:if="${param.logout}">
                            You have been logged out.
                        </div>

                        <a class="auth-google-btn auth-google-btn--modal" th:href="@{/auth/google}">
                            <i class="bi bi-google" aria-hidden="true"></i>
                            Continue with Google
                        </a>

                        <div class="auth-divider auth-divider--modal">or</div>

                        <form class="custom-form auth-form" th:action="@{/login}" method="post" role="form">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                            <input type="email" name="email" class="form-control" placeholder="Email" required>
                            <input type="password" name="password" class="form-control" placeholder="Password" required>

                            <div class="d-flex justify-content-end align-items-center auth-links">
                                <a href="/forgot-password" th:href="@{/forgot-password}">Forgot password?</a>
                            </div>

                            <button type="submit" class="form-control mt-3">Sign in</button>
                        </form>

                        <p class="auth-footer">Don't have an account? <a href="#" data-auth-trigger="register">Create one now</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade auth-modal" id="registerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content auth-modal-content">
                <div class="modal-body">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    <div class="auth-card auth-card--modal">
                        <h3 class="mb-3">Create account</h3>
                        <p class="auth-subtitle">Fill in your details to join the community.</p>

                        <div class="alert alert-danger" th:if="${param.registerError}">
                            Please fill in all fields correctly.
                        </div>

                        <a class="auth-google-btn auth-google-btn--modal" th:href="@{/auth/google}">
                            <i class="bi bi-google" aria-hidden="true"></i>
                            Continue with Google
                        </a>

                        <div class="auth-divider auth-divider--modal">or</div>

                        <form class="custom-form auth-form" th:action="@{/register}" method="post" role="form">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                            <input type="text" name="fullName" class="form-control" placeholder="Full name" required>
                            <input type="email" name="email" class="form-control" placeholder="Email" required>
                            <input type="password" name="password" class="form-control" placeholder="Password" minlength="6" required>
                            <input type="password" name="confirmPassword" class="form-control" placeholder="Confirm password" minlength="6" required>

                            <label class="form-check-label auth-check">
                                <input class="form-check-input me-2" type="checkbox" required>
                                I agree to the <a href="/terms" th:href="@{/terms}">Terms and conditions</a>.
                            </label>

                            <button type="submit" class="form-control mt-3">Create account</button>
                        </form>

                        <p class="auth-footer">Already have an account? <a href="#" data-auth-trigger="login">Sign in</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
